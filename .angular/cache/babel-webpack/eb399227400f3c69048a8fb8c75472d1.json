{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { NavigationEnd, NavigationError, NavigationStart } from \"@angular/router\";\nimport { distinctUntilChanged, filter, map, take, takeUntil } from \"rxjs/operators\";\nimport { Subject } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../queries/legal-entity.queries\";\nimport * as i2 from \"../states/legal-entity.store\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"../services/analytics.service\";\nimport * as i5 from \"../queries/user.queries\";\nimport * as i6 from \"../services/session.service\";\nimport * as i7 from \"../queries/alerts.query\";\nimport * as i8 from \"@cmx-web-components/angular\";\nimport * as i9 from \"../header-utils/header-utils.component\";\nimport * as i10 from \"../nav/nav.component\";\nimport * as i11 from \"@angular/common\";\nimport * as i12 from \"../pipes/translate.pipe\";\n\nfunction AppLayoutComponent_cwc_alert_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"cwc-alert\", 10);\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"variant\", ctx_r0.alertInfo.variant)(\"message\", ctx_r0.alertInfo.message)(\"ctaMessage\", ctx_r0.alertInfo.ctaMessage);\n  }\n}\n\nexport let AppLayoutComponent = /*#__PURE__*/(() => {\n  class AppLayoutComponent {\n    constructor(legalEntityQ, legalEntityStore, router, analytics, userQuery, sessionService, alertQuery) {\n      this.legalEntityQ = legalEntityQ;\n      this.legalEntityStore = legalEntityStore;\n      this.router = router;\n      this.analytics = analytics;\n      this.userQuery = userQuery;\n      this.sessionService = sessionService;\n      this.alertQuery = alertQuery;\n      this.destroyNotifier$ = new Subject();\n      this.googleDataLayer = window.dataLayer || []; // idenfity if the app has been reloaded somehow and extract the tokens\n      // firstly by refreshing the token\n\n      this.userQuery.selectUserProfile$.subscribe(profiles => {\n        // the initial values of the profiles is null\n        if (profiles === null && localStorage.getItem(\"bearer\") !== undefined && localStorage.getItem(\"bearer\") !== null) {\n          // we have token but no active information\n          this.sessionService.refreshToken().pipe(take(1)).subscribe();\n        }\n      });\n    }\n\n    ngOnInit() {\n      this.googleDataLayer = window.dataLayer || [];\n      this.legalEntityQ.selectAllLegalEntities$.subscribe(entities => {\n        this.updatedLegalEntities = entities;\n      });\n      this.legalEntityQ.selectActiveLegalEntity$.subscribe(entity => {\n        this.selectedLegalEntity = entity;\n      });\n      const trigger$ = this.legalEntityQ.selectActiveLegalEntity$.pipe(distinctUntilChanged(), filter(legalEntity => !!legalEntity), map(legalEntity => {// code here\n      }), takeUntil(this.destroyNotifier$));\n      trigger$.subscribe();\n      const alert$ = this.alertQuery.alertState$.pipe(map(alert => {\n        this.alertInfo = alert.info;\n\n        if (alert.show) {\n          this.triggerAlert();\n        }\n      }));\n      alert$.subscribe();\n      this.router.events.subscribe(event => {\n        if (event instanceof NavigationStart) {// on loading\n        }\n\n        if (event instanceof NavigationEnd) {\n          // on loaded\n          this.analytics.trigger();\n        }\n\n        if (event instanceof NavigationError) {// on error\n        }\n      });\n    }\n\n    ngOnDestroy() {\n      this.destroyNotifier$.next();\n    }\n\n    triggerAlert() {\n      (() => __awaiter(this, void 0, void 0, function* () {\n        yield customElements.whenDefined(\"cwc-alert\");\n        const cwcAlertElement = document.querySelector(\"cwc-alert\");\n        yield cwcAlertElement.showAlert();\n      }))();\n    }\n\n    activateLegalEntity(event) {\n      const entityAux = this.updatedLegalEntities.filter(entity => entity.legalEntityId === +event.detail.entityId)[0];\n\n      if (this.selectedLegalEntity.legalEntityId !== entityAux.legalEntityId) {\n        this.legalEntityStore.setActiveLegalEntity(entityAux);\n      }\n    }\n\n    isActiveLegalEntity(legalEntityId) {\n      return legalEntityId === this.selectedLegalEntity.legalEntityId;\n    }\n\n  }\n\n  AppLayoutComponent.ɵfac = function AppLayoutComponent_Factory(t) {\n    return new (t || AppLayoutComponent)(i0.ɵɵdirectiveInject(i1.LegalEntityQuery), i0.ɵɵdirectiveInject(i2.LegalEntityStore), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.AnalyticsService), i0.ɵɵdirectiveInject(i5.UserQuery), i0.ɵɵdirectiveInject(i6.SessionService), i0.ɵɵdirectiveInject(i7.AlertQuery));\n  };\n\n  AppLayoutComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AppLayoutComponent,\n    selectors: [[\"app-app-layout\"]],\n    decls: 21,\n    vars: 7,\n    consts: [[\"show-menu-button\", \"true\", \"slot\", \"header\"], [\"slot\", \"sidenav\", 2, \"z-index\", \"10\"], [\"id\", \"menuNav\", \"slot\", \"menu-items\"], [\"slot\", \"links\"], [\"href\", \"https://www.cemex.com/legal\", \"target\", \"_blank\", 3, \"label\"], [\"onclick\", \"window.alert('Triggered by a javascript function')\", 3, \"label\"], [\"label\", \"cemex.com\", \"href\", \"https://www.cemex.com\", \"target\", \"_blank\"], [\"slot\", \"copyright\"], [\"slot\", \"main\", 2, \"height\", \"100%\"], [3, \"variant\", \"message\", \"ctaMessage\", 4, \"ngIf\"], [3, \"variant\", \"message\", \"ctaMessage\"]],\n    template: function AppLayoutComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"cwc-page\");\n        i0.ɵɵelementStart(1, \"cwc-header\", 0);\n        i0.ɵɵelement(2, \"app-header-utils\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"cwc-sidenav\", 1);\n        i0.ɵɵelementStart(4, \"cwc-sidenav-menu\", 2);\n        i0.ɵɵelement(5, \"app-nav\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"cwc-footer-menu\", 3);\n        i0.ɵɵelement(7, \"cwc-footer-menu-item\", 4);\n        i0.ɵɵpipe(8, \"translate\");\n        i0.ɵɵelement(9, \"cwc-footer-menu-item\", 5);\n        i0.ɵɵpipe(10, \"translate\");\n        i0.ɵɵelement(11, \"cwc-footer-menu-item\", 6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"div\", 7);\n        i0.ɵɵtext(13, \" \\u00A9 2017-2019 CEMEX\");\n        i0.ɵɵelement(14, \"br\");\n        i0.ɵɵtext(15, \" International Holding AG.\");\n        i0.ɵɵelement(16, \"br\");\n        i0.ɵɵtext(17, \" All rights reserved. \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"div\", 8);\n        i0.ɵɵtemplate(19, AppLayoutComponent_cwc_alert_19_Template, 1, 3, \"cwc-alert\", 9);\n        i0.ɵɵelement(20, \"router-outlet\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(7);\n        i0.ɵɵpropertyInterpolate(\"label\", i0.ɵɵpipeBind1(8, 3, \"legal\"));\n        i0.ɵɵadvance(2);\n        i0.ɵɵpropertyInterpolate(\"label\", i0.ɵɵpipeBind1(10, 5, \"privacy\"));\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"ngIf\", ctx.alertInfo);\n      }\n    },\n    directives: [i8.CwcPage, i8.CwcHeader, i9.HeaderUtilsComponent, i8.CwcSidenav, i8.CwcSidenavMenu, i10.NavComponent, i8.CwcFooterMenu, i8.CwcFooterMenuItem, i11.NgIf, i3.RouterOutlet, i8.CwcAlert],\n    pipes: [i12.TranslatePipe],\n    styles: [\"[_nghost-%COMP%]{display:block}\"]\n  });\n  return AppLayoutComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}